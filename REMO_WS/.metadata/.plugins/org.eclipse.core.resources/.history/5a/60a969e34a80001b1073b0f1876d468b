package hu.bme.mit.yakindu.analysis.workhere;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Scanner;

import org.yakindu.sct.model.sgraph.Statechart;

import hu.bme.mit.yakindu.analysis.RuntimeService;
import hu.bme.mit.yakindu.analysis.TimerService;
import hu.bme.mit.yakindu.analysis.example.ExampleStatemachine;
import hu.bme.mit.yakindu.analysis.example.IExampleStatemachine;

public class Generator {
	
	private Statechart s;
	private ArrayList<String> lines = new ArrayList<String>();
	
	public Generator (Statechart s) {
		this.s = s;
	}
	
	public Generator Generate() {
		lines.add("public class RunStatechart {");
		addMain();
		lines.add("");
		
		
		
		lines.add("");
		lines.add("");
		lines.add("}"); //closing } for class
		return this;
	}
	
	public void PrintOut() {
		for (String l: lines)
			System.out.println(l);
	}
	
	private void addMain() {		
		lines.add("public static void main(String[] args) throws IOException {");
		lines.add("ExampleStatemachine s = new ExampleStatemachine();");
		lines.add("s.setTimer(new TimerService());");
		lines.add("RuntimeService.getInstance().registerStatemachine(s, 200);");
		lines.add("s.init();");
		lines.add("s.enter();");
		lines.add("s.runCycle();");
		lines.add("print(s);");
		lines.add("Scanner sc = new Scanner(System.in);");
		lines.add("while (true) Parse(s, sc.nextLine());");
		lines.add("}");
	}
	
	private void addParser() {
		
		
	}


		
		public static void Parse(ExampleStatemachine sm, String s) {
			//"Minden beolvasott sor után írjuk ki az összes változó (WhiteTime és BlackTime) értékét!"
			//Itt a sor beolvasása után egyből kiírom, mert így értelmeztem, 
			// hogy még a parancs értelmezése előtt írjam ki.
			print(sm);
			switch (s) {
			case "start":
				sm.raiseStart();
				sm.runCycle();
				break;
			case "white":
				sm.raiseWhite();
				sm.runCycle();
				break;
			case "black":
				sm.raiseBlack();
				sm.runCycle();
				break;
			case "exit":
				System.exit(0);
			}
		}

		public static void print(IExampleStatemachine s) {
			System.out.println("W = " + s.getSCInterface().getWhiteTime());
			System.out.println("B = " + s.getSCInterface().getBlackTime());
		}
	}
	
	
}
